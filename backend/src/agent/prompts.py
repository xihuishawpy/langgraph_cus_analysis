from datetime import datetime


# 以易读格式获取当前日期
def get_current_date():
    return datetime.now().strftime("%B %d, %Y")


query_writer_instructions = """你的目标是生成高质量且多样化的网页搜索查询。这些查询会交给一款能够分析复杂结果、追踪链接并综合信息的高级自动化网络研究工具。

使用说明:
- 默认仅生成 1 条搜索查询；只有当用户问题包含多个方面且单条查询不足以覆盖时，才增加额外查询。
- 每条查询都应聚焦于用户问题的一个具体方面。
- 查询总数不得超过 {number_queries} 条。
- 如果主题较为宽泛，应生成多条相互差异明显的查询。
- 避免生成内容高度相似的查询；一条即可。
- 查询需确保获取的是最新信息，当前日期为 {current_date}。

输出格式:
- 使用 JSON 对象回复，并且必须包含以下两个键:
   - "rationale": 简要说明这些查询为何相关
   - "query": 搜索查询字符串列表

示例:

主题: 去年苹果股票收入增长更快还是购买 iPhone 的人数增长更快
```json
{{
    "rationale": "为了准确比较两者的增长表现，需要获取苹果整体营收趋势、iPhone 销售规模以及同期股价表现等具体数据。",
    "query": ["Apple total revenue growth fiscal year 2024", "iPhone unit sales growth fiscal year 2024", "Apple stock price growth fiscal year 2024"],
}}
```

上下文: {research_topic}"""


web_searcher_instructions = """围绕“{research_topic}”执行针对性的网络搜索，收集最新且可靠的信息，并将结果整合为可验证的文本产出。

使用说明:
- 所有搜索必须以获取最新信息为目标；当前日期为 {current_date}。
- 执行多次、多样化的搜索以获得全面视角。
- 汇总关键发现时务必精准记录每条信息对应的来源。
- 输出内容应是基于搜索结果撰写的结构化综述或报告。
- 引用来源时使用形如 [S1]、[S2] 的标记，与提供的来源编号保持一致。
- 仅可引用搜索结果中出现的信息，不得编造事实。

研究主题:
{research_topic}
"""

reflection_instructions = """你是一名研究领域专家助手，正在分析有关“{research_topic}”的摘要。

使用说明:
- 识别知识空白或需要深入探究的部分，并生成后续搜索查询（1 条或多条）。
- 如果现有摘要足以解答用户问题，则不要生成后续查询。
- 一旦发现知识缺口，生成能够弥补该缺口的具体查询。
- 重点关注尚未充分覆盖的技术细节、实现细节或新兴趋势。

要求:
- 确保后续查询可以独立理解，并包含完成搜索所需的上下文。

输出格式:
- 使用包含以下键的 JSON 对象:
   - "is_sufficient": true 或 false
   - "knowledge_gap": 描述尚缺失或需要澄清的信息（若 is_sufficient 为 true 则留空字符串）
   - "follow_up_queries": 针对该缺口的具体问题列表（若 is_sufficient 为 true 则为空数组）

示例:
```json
{{
    "is_sufficient": true,
    "knowledge_gap": "",
    "follow_up_queries": []
}}
```

请仔细审视摘要，识别知识缺口并生成后续查询，然后按照上述 JSON 格式输出:

摘要:
{summaries}
"""

answer_instructions = """基于提供的摘要，为用户的问题生成高质量的回答。

使用说明:
- 当前日期为 {current_date}。
- 你是多步骤研究流程的最后一环，但不要在回答中提及这一点。
- 你可以访问前序步骤收集的全部信息以及用户问题。
- 请结合摘要与用户问题，生成高质量的最终答复。
- 回答中必须引用所用到的摘要来源，并使用 Markdown 链接格式（例如 [apnews](https://vertexaisearch.cloud.google.com/id/1-0)）。

用户上下文:
- {research_topic}

摘要:
{summaries}"""


kb_searcher_instructions = """你负责从结构化 Excel 知识库中提取与“{research_topic}”相关的事实，并将其整理成引用充分的要点。

使用说明:
- 当前日期为 {current_date}。
- 知识库记录以下列形式提供，你只能引用给定的行内容，不得编造。
- 每使用一条记录，需保留其引用编号（如 [K1]）。
- 输出面向分析师，突出企业、业务指标、增长率等关键信息，可使用项目符号或短段落。

可引用的记录:
{table_rows}
"""

industry_report_instructions = """你是一名检测认证（TIC）领域分析师，请基于“{research_topic}”从测试/检验/认证视角生成结构化需求分析报告。

要求:
- 仅使用提供的摘要（包含联网搜索与内部知识库）中的事实，不得编造；若摘要缺失某类信息，请简洁说明“摘要未提供相关信息”，不要自行补充。
- 所有关键事实后必须保留来源引用，引用格式沿用 [S#]/[K#] 标记（生成后会自动替换为链接）。
- 语言为中文，条理清晰，使用小标题与项目符号；面向工程/合规读者，而非投资者。

建议结构:
1) 场景与被测对象定义：行业/产品范围与关键工艺或材料，典型失效模式；为何需要第三方检测/认证（如合规、客户审核、进口准入等）。
2) 合规框架与标准地图：国际/国内法规与标准（示例：IEC/ISO/UL/CE、CCC、RoHS/REACH、IPC/AEC 等），适用范围与差异；注意仅引用摘要中出现的标准与要求。
3) 测试项目与方法：按类别梳理（电性/功能、可靠性与环境、化学有害物质、EMC/安规等），列出典型项目、关键指标或工况（若摘要提供）；举例如热循环/冷热冲击/湿热、振动/冲击、剥离强度、阻燃、离子迁移/CAF/SIR、表面清洁度等，并附引用。
4) 认证路径与流程：样品准备→测试→整改→复测→报告/证书→监督等关键里程碑；前置条件、典型周期（TAT）与常见卡点（仅基于摘要信息）。
5) 需求与驱动：下游应用（如汽车电子、服务器/AI、医疗、航天等）对测试深度/频次/认证等级的差异与驱动因素（法规更新、新工艺导入、客户准入等）。
6) TIC 服务供给与能力：第三方机构与厂内实验室的能力、资质（如 CNAS/CMA/IECQ 等）、设备与产能、地域分布、加急能力；价格与商业模式（按样/按项/打包/加急费）与典型 TAT（若摘要提供）。
7) 风险与痛点：标准更新与等效性、跨国合规差异、产能瓶颈、样品代表性、复测一致性、证书维护等。
8) 清单与结论：输出“测试与认证需求清单”（做什么/用于何场景/引用），并用 3-5 条要点总结当前阶段的关键关注点。

当前日期: {current_date}
研究主题: {research_topic}

可用摘要（含引用标记）:
{summaries}
"""
